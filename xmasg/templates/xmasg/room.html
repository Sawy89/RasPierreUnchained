{% extends "base.html" %}
{% load static %}


{% block head %}
<link rel="stylesheet" type="text/css" href="{% static '/xmasg/xmasg.css' %}">
<script src="{% static 'xmasg/room.js' %}"></script>
<!-- Variable to javascript -->
<script>
  var roomAdmin = {{ room.is_user_admin|yesno:"true,false" }};
  {% if form_add_member is None %}
    var userIsMember = true;
  {% else %}
    var userIsMember = false;
  {% endif %}
  var url_xmasgajax_roommember_exclusion = '{% url 'xmasgajax_roommember_exclusion' %}';
</script>
{% endblock %}


{% block h1title %}
<h1>Stanza: {{room.name}}!</h1>
{% endblock %}


{% block sidebarbutton %}
{% include "xmasg/element_sidebar_button.html" %}
{% endblock %}


{% block sidebar %}
{% include "xmasg/element_sidebar.html" %}
{% endblock %}


{% block content %}
<div id="content" class="container">
  <!-- Dati della stanza -->
  <div class="room-info">
    <h2>Benvenuto!</h2>
    <h3>{{ room.name }} - {{ room.description }}</h3>
    <p>L'estrazione avverrà il {{ room.end_date_str }}: mancano {{ room.end_date_delta_str }}</p>
    <h4>Ecco i partecipanti</h4>
    <form>
      <table class="room-member table">
        <tr>
          <th scope='col'>User</th>
          <th scope='col'>Nome</th>
          <th scope='col'>Admin</th>
          <th scope='col'>Esclusione</th>
        </tr>
        {% for member in room_members %}
          <tr>
            <td scope='row'>{{ member.member.username }}</td>
            <td>{{ member.member.first_name }} {{ member.member.last_name }}</td>
            {% if member.is_admin %}
              <td><input type="checkbox" id="admin-{{ member.member.username }}" name="is-admin" data-defaultvalue="checked" value="{{ member.member.username }}" checked></td>
            {% else %}
              <td><input type="checkbox" id="admin-{{ member.member.username }}" name="is-admin" data-defaultvalue="" value="{{ member.member.username }}"></td>
            {% endif %}
            {% if member.is_your_exclusion %}
              <td><input type="checkbox" id="exclusion-{{ member.member.username }}" name="is-your-exclusion" data-defaultvalue="checked" value="{{ member.member.username }}" checked></td>
            {% else %}
              <td><input type="checkbox" id="exclusion-{{ member.member.username }}" name="is-your-exclusion" data-defaultvalue="" value="{{ member.member.username }}"></td>
            {% endif %}
          </tr>
        {% endfor%}
      </table>
      <input id="bnt-change-member" type="submit" class="btn btn-primary" value="Modifica">
    </form>
  </div>

  <!-- Iscritto o no -->
  {% if form_add_member is not None %}
    <form name="addRoomMember" action="{% url 'xmasg_room_add_member' %}" method="POST">
      {% csrf_token %}
      {% for field in form_add_member %}
        {{ field }}
      {% endfor %}
      <input type="submit" class="btn btn-primary" value="Unisciti">
    </form>
  {% else %}
    <p>Sei già iscritto! Ollè!</p>
  {% endif %}
</div>
{% endblock %}
